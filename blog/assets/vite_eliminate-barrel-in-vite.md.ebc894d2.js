import{_ as e,o as s,c as a,M as o}from"./chunks/framework.0a4c9d35.js";const t="/blog/assets/module-graph-with-barrel.227d3a88.jpg",F=JSON.parse('{"title":"Speed up loading barrel file in Vite","description":"","frontmatter":{"sidebar":false,"head":[["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:title","content":"Speed up loading barrel file in Vite"}],["meta",{"property":"og:image","content":"https://.png"}],["meta",{"property":"twitter:image:src","content":"https://.png"}],["meta",{"property":"og:url","content":"https://sun0day.github.io/blog/vite/remove-barrel-in-vite.html"}],["meta",{"property":"og:description","content":"Speed up loading barrel file via vite-plugin-import-redirect"}],["meta",{"name":"twitter:card","content":"summary_large_image"}]]},"headers":[],"relativePath":"vite/eliminate-barrel-in-vite.md","lastUpdated":1707040883000}'),n={name:"vite/eliminate-barrel-in-vite.md"},l=o('<h1 id="speed-up-loading-barrel-file-in-vite" tabindex="-1">Speed up loading barrel file in Vite <a class="header-anchor" href="#speed-up-loading-barrel-file-in-vite" aria-label="Permalink to &quot;Speed up loading barrel file in Vite&quot;">​</a></h1><h2 id="barrel-file-debacle" tabindex="-1">Barrel file debacle <a class="header-anchor" href="#barrel-file-debacle" aria-label="Permalink to &quot;Barrel file debacle&quot;">​</a></h2><blockquote><p>A &quot;barrel file&quot; is file that does nothing but only re-export other files.</p></blockquote><p>Bigger projects with barrel files typically produce more complex module graphs. When constructing a module graph, the bundler needs to</p><ul><li>load all the related files</li><li>parse and transform those files</li><li>do some optimization(e.g. tree-shaking)</li><li>etc...</li></ul><p>This means the bundler has to spend more time constructing a complex module graph. <a href="https://twitter.com/marvinhagemeist" target="_blank" rel="noreferrer">@marvinhagemeist</a> explained in more detail how the barrel file affects bundling speed in this <a href="https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-7/" target="_blank" rel="noreferrer">article</a>.</p><p>However, when it comes to Vite, barrel file slows down not only building speed but also dev page load speed. Suppose there is a module graph containing a barrel file below:</p><p><img src="'+t+`" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// pageA.jsx</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;">ComponentA</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ComponentB</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./component</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// pageB.jsx </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;">ComponentC</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./component</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// component/index.jsx -&gt; barrel file</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ComponentA</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./ComponentA</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ComponentB</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./ComponentB</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ComponentC</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./ComponentC</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ComponentD</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./ComponentD</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>Then start the Vite dev server and open <code>pageA</code> in the browser, you can find <code>ComponentA</code>, <code>ComponentB</code>, <code>ComponentC</code> and <code>ComponentD</code> are all loaded despite that <code>pageA</code> only imports <code>ComponentA</code> and <code>ComponentB</code>. So does <code>pageB</code>. What&#39;s worse, modifying irrelevant <code>ComponentD</code> will trigger HMR even page reload. It&#39;s fine for this tiny codebase, but how about hundreds even thousands of import requests. Although Vite dev server is fast enough to handle import requests, modern browsers usually have a maximum parallel HTTP connection limit which means current import requests would block the next coming requests.</p><h2 id="coexist-with-barrel-file" tabindex="-1">Coexist with barrel file <a class="header-anchor" href="#coexist-with-barrel-file" aria-label="Permalink to &quot;Coexist with barrel file&quot;">​</a></h2><p>Although barrel file is a burden for bundlers, it&#39;s still quite neat for developers, no? Besides, getting rid of barrel files might not be an easy thing, especially in some large projects. Developers have to change all the barrel file imports to directly import target modules. It&#39;s simple but tedious. Of course, you can write some scripts to do code shift. But next time you maintain another project, you have to do it again, quite annoying, no?</p><h2 id="speed-up-loading-barrel-file-in-vite-1" tabindex="-1">Speed up loading barrel file in Vite <a class="header-anchor" href="#speed-up-loading-barrel-file-in-vite-1" aria-label="Permalink to &quot;Speed up loading barrel file in Vite&quot;">​</a></h2><h3 id="use-http-2" tabindex="-1">Use HTTP/2 <a class="header-anchor" href="#use-http-2" aria-label="Permalink to &quot;Use HTTP/2&quot;">​</a></h3><h3 id="redirect-import" tabindex="-1">Redirect <code>import</code> <a class="header-anchor" href="#redirect-import" aria-label="Permalink to &quot;Redirect \`import\`&quot;">​</a></h3>`,15),p=[l];function r(i,c,d,y,D,m){return s(),a("div",null,p)}const f=e(n,[["render",r]]);export{F as __pageData,f as default};
